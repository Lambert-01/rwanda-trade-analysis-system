<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Intelligence | Rwanda Trade Analysis</title>

    <!-- Meta Tags -->
    <meta name="description" content="AI-powered trade intelligence for Rwanda - evidence-based insights using NISR data">
    <meta name="keywords" content="Rwanda, AI, trade intelligence, NISR, analytics, DeepSeek, OpenRouter">
    <meta name="author" content="Rwanda Trade Intelligence Assistant">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">

    <!-- External Libraries CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/predictions.css">

    <style>
        /* AI Intelligence Page Specific Styles */
        .ai-chat-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .welcome-message .ai-message {
            margin-bottom: 20px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-author {
            font-weight: 600;
            color: #495057;
        }

        .message-time {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .message-text {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            line-height: 1.5;
        }

        .chat-input-container {
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .chat-input-wrapper {
            padding: 15px 20px;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .suggested-prompts {
            padding: 0 20px 15px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .suggested-prompts::-webkit-scrollbar {
            display: none;
        }

        .suggested-prompt {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            color: #495057;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .suggested-prompt:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Quick Actions Panel */
        .quick-actions-panel, .reports-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .quick-actions-panel h4, .reports-panel h4 {
            margin-bottom: 8px;
            color: #495057;
        }

        .quick-actions-list, .reports-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quick-action-item, .report-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }

        .quick-action-item:hover, .report-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
        }

        .quick-action-item i, .report-icon {
            width: 20px;
            margin-right: 12px;
            color: #667eea;
        }

        .report-item {
            justify-content: space-between;
        }

        .report-info h6 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }

        .report-info small {
            color: #6c757d;
            font-size: 12px;
        }

        .report-item i:last-child {
            color: #6c757d;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .chart-container.tall {
            height: 400px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .ai-chat-container {
                height: 500px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .suggested-prompts {
                padding: 0 15px 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Modern Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="assets/images/NISR.png" alt="NISR Logo" class="nisr-logo">
                <h3>Rwanda Trade Analysis</h3>
                <span class="ai-badge">AI-Powered</span>
            </div>
        </div>

        <div class="sidebar-menu">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="exports.html" class="nav-link" data-page="exports">
                        <i class="fas fa-arrow-up"></i>
                        <span>Exports</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="imports.html" class="nav-link" data-page="imports">
                        <i class="fas fa-arrow-down"></i>
                        <span>Imports</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="predictions.html" class="nav-link active" data-page="predictions">
                        <i class="fas fa-brain"></i>
                        <span>AI Intelligence</span>
                        <div class="nav-indicator"></div>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="analytics.html" class="nav-link" data-page="analytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Advanced Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="commodities.html" class="nav-link" data-page="commodities">
                        <i class="fas fa-boxes"></i>
                        <span>Commodities</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="regional.html" class="nav-link" data-page="regional">
                        <i class="fas fa-globe-africa"></i>
                        <span>Regional Analysis</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name">Trade Analyst</span>
                    <span class="user-role">NISR Dashboard</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Top Header Bar -->
    <header class="top-header">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle Navigation Menu">
                <i class="fas fa-bars"></i>
            </button>
            <div class="page-title">
                <h1>AI Intelligence</h1>
                <p>Advanced analytical system for evidence-based policy insights</p>
            </div>
        </div>

        <div class="header-right">
            <div class="header-actions">
                <button class="btn btn-refresh" onclick="location.reload()" title="Refresh Data">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="time-display">
                    <i class="fas fa-clock"></i>
                    <span id="current-time">Loading...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="spinner-container">
                <div class="spinner"></div>
                <p class="loading-text">Initializing AI Intelligence...</p>
                <small class="text-muted">Loading NISR datasets and AI models...</small>
            </div>
        </div>

        <!-- AI Status Bar -->
        <section class="container-fluid mb-4">
            <div class="ai-status-bar">
                <div id="ai-status-badge" class="ai-status-badge unavailable">
                    <i class="fas fa-circle-notch fa-spin me-2"></i>Checking AI Status...
                </div>
                <div class="ai-status-info">
                    <div class="status-item">
                        <i class="fas fa-database"></i>
                        <span>NISR Data Loaded</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-brain"></i>
                        <span>AI Model Active</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics Ready</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Intelligence Assistant -->
        <section class="container-fluid mb-5">
            <div class="row">
                <div class="col-lg-8">
                    <h2 class="section-title">
                        <i class="fas fa-brain me-2"></i>AI Intelligence Assistant
                    </h2>
                    <p class="section-subtitle">Ask evidence-based questions about Rwanda's trade data and receive structured analytical responses</p>

                    <div class="ai-chat-container">
                        <div class="chat-header">
                            <h3><i class="fas fa-robot me-2"></i>DeepSeek AI Intelligence Assistant</h3>
                            <span class="badge bg-primary">Powered by OpenRouter</span>
                        </div>

                        <div class="chat-messages" id="chat-messages">
                            <div class="welcome-message">
                                <div class="ai-message">
                                    <div class="message-avatar">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="message-content">
                                        <div class="message-header">
                                            <span class="message-author">DeepSeek AI</span>
                                            <span class="message-time">Just now</span>
                                        </div>
                                        <div class="message-text">
                                            Hello! I'm your AI Trade Intelligence Assistant. I can provide evidence-based insights about Rwanda's trade data using NISR datasets, processed analytics, and contextual analysis. Ask me anything about exports, imports, trade balance, commodities, or regional trends.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <input
                                    type="text"
                                    id="ai-chat-input"
                                    class="chat-input"
                                    placeholder="Ask about Rwanda's trade data, forecasts, or policy insights..."
                                    autocomplete="off"
                                >
                                <button id="send-chat-btn" class="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>

                            <div class="suggested-prompts">
                                <button class="suggested-prompt" data-question="Why did Rwanda's exports increase in Q1 2025 compared to Q4 2024?">
                                    üìà Export Growth Analysis
                                </button>
                                <button class="suggested-prompt" data-question="What are the key trends in Rwanda's imports and their implications?">
                                    üì• Import Trends & Implications
                                </button>
                                <button class="suggested-prompt" data-question="Analyze Rwanda's trade balance and provide strategic recommendations.">
                                    ‚öñÔ∏è Trade Balance Strategy
                                </button>
                                <button class="suggested-prompt" data-question="What are the biggest risks to Rwanda's trade and how can they be mitigated?">
                                    üõ°Ô∏è Risk Assessment & Mitigation
                                </button>
                                <button class="suggested-prompt" data-question="Provide commodity-level analysis and future opportunities.">
                                    üì¶ Commodity Opportunities
                                </button>
                                <button class="suggested-prompt" data-question="What is the forecast for Rwanda's trade performance over the next year?">
                                    üîÆ Trade Forecast 2025-2026
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Quick Actions -->
                    <div class="quick-actions-panel">
                        <h4><i class="fas fa-zap me-2"></i>Quick Intelligence Queries</h4>
                        <p class="text-muted small">Get instant AI-powered analysis</p>

                        <div class="quick-actions-list">
                            <button class="quick-action-item" data-action="analyze-exports">
                                <i class="fas fa-arrow-trend-up"></i>
                                <span>Export Analysis</span>
                            </button>
                            <button class="quick-action-item" data-action="analyze-imports">
                                <i class="fas fa-arrow-trend-down"></i>
                                <span>Import Analysis</span>
                            </button>
                            <button class="quick-action-item" data-action="trade-balance">
                                <i class="fas fa-balance-scale"></i>
                                <span>Trade Balance</span>
                            </button>
                            <button class="quick-action-item" data-action="commodity-trends">
                                <i class="fas fa-boxes"></i>
                                <span>Commodity Trends</span>
                            </button>
                            <button class="quick-action-item" data-action="regional-insights">
                                <i class="fas fa-globe-africa"></i>
                                <span>Regional Insights</span>
                            </button>
                            <button class="quick-action-item" data-action="forecast-analysis">
                                <i class="fas fa-crystal-ball"></i>
                                <span>Forecast Analysis</span>
                            </button>
                            <button class="quick-action-item" data-action="risk-assessment">
                                <i class="fas fa-shield-alt"></i>
                                <span>Risk Assessment</span>
                            </button>
                            <button class="quick-action-item" data-action="policy-recommendations">
                                <i class="fas fa-lightbulb"></i>
                                <span>Policy Recommendations</span>
                            </button>
                        </div>
                    </div>

                    <!-- AI Analysis Reports -->
                    <div class="reports-panel mt-4">
                        <h4><i class="fas fa-file-alt me-2"></i>AI Analysis Reports</h4>
                        <p class="text-muted small">Generate comprehensive PDF reports</p>

                        <div class="reports-list">
                            <button class="report-item" onclick="generateReport('exports')">
                                <div class="report-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="report-info">
                                    <h6>Export Performance Report</h6>
                                    <small>Trends, commodities, opportunities</small>
                                </div>
                                <i class="fas fa-download"></i>
                            </button>

                            <button class="report-item" onclick="generateReport('imports')">
                                <div class="report-icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="report-info">
                                    <h6>Import Dependency Analysis</h6>
                                    <small>Patterns, risks, substitutions</small>
                                </div>
                                <i class="fas fa-download"></i>
                            </button>

                            <button class="report-item" onclick="generateReport('balance')">
                                <div class="report-icon">
                                    <i class="fas fa-balance-scale"></i>
                                </div>
                                <div class="report-info">
                                    <h6>Trade Balance Strategy</h6>
                                    <small>Recommendations, resilience</small>
                                </div>
                                <i class="fas fa-download"></i>
                            </button>

                            <button class="report-item" onclick="generateReport('regional')">
                                <div class="report-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div class="report-info">
                                    <h6>Regional Integration Report</h6>
                                    <small>Blocs, opportunities</small>
                                </div>
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- External Libraries JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Custom JavaScript -->
    <script src="js/main.js"></script>
    <script src="js/predictions.js"></script>

    <!-- Initialize Time Display and Sidebar -->
    <script>
        // Update time display
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            const el = document.getElementById('current-time');
            if (el) {
                el.textContent = `${dateString}, ${timeString}`;
            }
        }

        updateTime();
        setInterval(updateTime, 60000);

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        if (sidebarToggle && sidebar && sidebarOverlay) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                sidebarOverlay.classList.toggle('active');
            });

            sidebarOverlay.addEventListener('click', function() {
                sidebar.classList.remove('collapsed');
                sidebarOverlay.classList.remove('active');
            });
        }

        // PDF Report generation function
        async function generateReport(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Report configurations
            const reportConfigs = {
                'exports': {
                    title: 'Export Performance Report',
                    subtitle: 'Detailed Analysis of Export Trends, Commodities, and Market Opportunities',
                    question: 'Generate a comprehensive export performance report including trends, commodities, and recommendations.',
                    icon: 'üìà'
                },
                'imports': {
                    title: 'Import Dependency Analysis Report',
                    subtitle: 'Assessment of Import Patterns, Dependency Risks, and Substitution Opportunities',
                    question: 'Create an import dependency analysis report with risk assessment and mitigation strategies.',
                    icon: 'üì¶'
                },
                'balance': {
                    title: 'Trade Balance Strategy Report',
                    subtitle: 'Strategic Recommendations for Improving Rwanda\'s Trade Balance and Economic Resilience',
                    question: 'Produce a trade balance strategy report with policy recommendations.',
                    icon: '‚öñÔ∏è'
                },
                'regional': {
                    title: 'Regional Integration Report',
                    subtitle: 'Analysis of Regional Trade Blocs and Integration Opportunities for Rwanda',
                    question: 'Generate a regional integration report analyzing trade blocs and opportunities.',
                    icon: 'üåç'
                }
            };

            const config = reportConfigs[type];
            if (!config) return;

            try {
                // Show loading
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                btn.disabled = true;

                // Get AI analysis
                const response = await fetch('/api/chat/message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: config.question })
                });

                const data = await response.json();

                if (data.success && data.response) {
                    // Create PDF
                    doc.setFontSize(20);
                    doc.text(`${config.icon} ${config.title}`, 20, 30);

                    doc.setFontSize(12);
                    doc.text(config.subtitle, 20, 45);

                    // Add metadata
                    doc.setFontSize(10);
                    doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 60);
                    doc.text(`AI Model: DeepSeek via OpenRouter`, 20, 70);
                    doc.text(`Source: NISR Trade Data Analysis Platform`, 20, 80);

                    // Add horizontal line
                    doc.line(20, 85, 190, 85);

                    // Process AI response and format for PDF
                    const aiResponse = data.response;
                    const lines = doc.splitTextToSize(aiResponse, 170);

                    let yPosition = 100;
                    doc.setFontSize(11);

                    for (let i = 0; i < lines.length; i++) {
                        if (yPosition > 270) { // New page if needed
                            doc.addPage();
                            yPosition = 30;
                        }
                        doc.text(lines[i], 20, yPosition);
                        yPosition += 6;
                    }

                    // Add footer
                    const pageCount = doc.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.text(`Page ${i} of ${pageCount}`, 20, 285);
                        doc.text('Rwanda Trade Intelligence Assistant - NISR Hackathon 2025', 100, 285);
                    }

                    // Save PDF
                    const filename = `${config.title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                    doc.save(filename);

                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;

                    // Show success message
                    showNotification('Report generated successfully!', 'success');
                } else {
                    throw new Error('Failed to generate AI analysis');
                }

            } catch (error) {
                console.error('Report generation error:', error);
                showNotification('Failed to generate report. Please try again.', 'error');

                // Reset button
                const btn = event.target;
                btn.innerHTML = '<i class="fas fa-download"></i>';
                btn.disabled = false;
            }
        }

        // Notification function
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
